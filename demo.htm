<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SVG Pie Timer Demo</title>
    <style>
        body, a {
            font-family: sans-serif;
            color: #444;
            text-align: center
        }

        svg {
            display: block;
            margin: 50px auto;
            width: 250px;
            height: 250px;
        }

        #loader 
        { fill: #bd4 }

        #border 
        { fill: #9b2 }
    </style>
</head>
<body>
    <svg viewbox="0 0 250 250">
        <path id="border" transform="translate(125,125)"/>
        <path id="loader" transform="translate(125,125) scale(.84)"/>
    </svg>
    <h1>SVG Pie Timer Demo</h1>
    <p>See <a href="https://github.com/agrimsrud/svgPieTimer.js">github.com/agrimsrud/svgPieTimer.js</a>.</p>
    <script src="http://cdn.rawgit.com/darius/requestAnimationFrame/master/requestAnimationFrame.js"></script>
    <script>

    ;(function(w) {

        'use strict';

        Date.now = Date.now || function() { return +new Date };
      
        function draw(element, rate) {
            var count = element.length,
                angle = 360 * rate;

            angle %= 360;

            var rad = (angle * Math.PI / 180), 
                x = Math.sin(rad) * 125, 
                y = Math.cos(rad) * - 125, 
                mid = (angle > 180) ? 1 : 0, 
                shape = 'M 0 0 v -125 A 125 125 1 ' 
                       + mid + ' 1 ' 
                       +  x  + ' ' 
                       +  y  + ' z';
          
            if(element instanceof Array)
                while(count--)
                    element[count].setAttribute('d', shape)
            else
                element.setAttribute('d', shape)
        }
      
        w.svgPieTimer = function(props) {

            var element = props.element,
                duration = props.duration || 1000,
                n = props.loops;

            if(!element) throw "SVG Pie Timer: Element required"

            n = (n==0) ? 0 : n ? n : 1;

            var end = Date.now() + duration * n,
                totaldur = duration * n;
          
            (function frame() {
                var current = Date.now(),
                    remaining = end - current,

                    rate = n + 1 - remaining / duration;
              
                if(remaining < 60) {
                  
                    draw(element, n - 0.0001);
                 
                    if(remaining < totaldur && n) return
                }

                draw(element, rate);
              
               requestAnimationFrame(frame);
            }());
        }

    })( window, undefined );

    var loader = document.getElementById('loader'),
        border = document.getElementById('border');

    svgPieTimer({
        element: [loader, border],
        duration: 1000,
        loops: 2
    });
    </script>
</body>
</html>